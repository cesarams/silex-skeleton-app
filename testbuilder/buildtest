#!/usr/bin/env php

<?php

require_once __DIR__.'/../vendor/autoload.php';
require_once 'Bob/ControllerTestBuilder.php';
require_once 'Bob/ControllerCoreTestBuilder.php';
require_once 'Bob/RepositoryCoreTestBuilder.php';
require_once 'Bob/RepositoryTestBuilder.php';
require_once 'Bob/DBTestBuilder.php';
require_once 'Bob/SeedTestBuilder.php';
require_once 'Bob/TestsBootstrapBuilder.php';

use Symfony\Component\ClassLoader\UniversalClassLoader;
use \Bob\ControllerTestBuilder;
use \Bob\ControllerCoreTestBuilder;
use \Bob\RepositoryCoreTestBuilder;
use \Bob\RepositoryTestBuilder;
use \Bob\DbTestBuilder;
use \Bob\SeedBuilder;
use \Bob\TestsBootstrapBuilder;

$loader = new UniversalClassLoader();

$loader = new UniversalClassLoader();

$dir            = __DIR__.'/../src/';
$entitiesExist  = scandir($dir);
$throwAway      = array_shift($entitiesExist);
$throwAway      = array_shift($entitiesExist);
$throwAway      = array_shift($entitiesExist);

$command        = $argv[1];
$rawArguments   = $argv;
$throwAway      = array_shift($rawArguments);
$throwAway      = array_shift($rawArguments);
$entityList     = $rawArguments;

$allEntities    = array_merge($entitiesExist, $entityList);

$config = array(
    'phpVersion' => "5.3.21",
    'category' => 'Api_Rest_Implementation_Tests',
    'organisation' => 'Thinkadoo',
    'author' => 'Andre Venter',
    'authorEmail' => 'andre.n.venter@gmail.com',
    'corganisationWebSite' => 'http://think-a-doo.net',
    'repository' => 'https://github.com/thinkadoo/silex-skeleton-rest.git'
    );

switch ($command) {


    case "testbundles":
        makeTests($entityList, $allEntities, $config);
        break;

    case "testcores":
        makeCoreTests($entityList, $allEntities, $config);
        break;

    case "testcontrollers":
        testController($entityList, $allEntities, $config);
        break;

    case "testrepositories":
        testRepository($entityList, $allEntities, $config);
        break;

    case "testrepositorycores":
        testRepository($entityList, $allEntities, $config);
        break;

    case "testcontrollercores":
        testController($entityList, $allEntities, $config);
        break;

}


    function makeTests($entityList, $allEntities, $config)
    {
        makeTestsBootstrapFile($allEntities);
        makeSupportFilesForTests($allEntities, $config);
        makeControllerTest($entityList, $config);
        makeRepositoryTest($entityList, $config);
        makeRepositoryCoreTest($entityList, $config);
        makeControllerCoreTest($entityList, $config);
    }

    function makeCoreTests($entityList, $allEntities, $config)
    {
        makeSupportFilesForTests($allEntities, $config);
        makeRepositoryCoreTest($entityList, $config);
        makeControllerCoreTest($entityList, $config);
    }

    function testController($entityList, $allEntities, $config)
    {
        makeSupportFilesForTests($allEntities, $config);
        makeControllerTest($entityList, $config);
    }

    function testRepository($entityList, $allEntities, $config)
    {
        makeSupportFilesForTests($allEntities, $config);
        makeRepositoryTest($entityList, $config);
        makeRepositoryCoreTest($entityList, $config);
    }

    function testRepositoryCore($entityList, $allEntities, $config)
    {
        makeSupportFilesForTests($allEntities, $config);
        makeRepositoryCoreTest($entityList, $config);
    }

    function testControllerCore($entityList, $allEntities, $config)
    {
        makeSupportFilesForTests($allEntities, $config);
        makeControllerCoreTest($entityList, $config);
    }

    function makeControllerTest($entityList, $config)
    {
        foreach($entityList as $className)
        {
            $bobControllerTestFile = new ControllerTestBuilder($entityList, $config, $className);
        }
    };

    function makeControllerCoreTest($entityList, $config)
    {
        foreach($entityList as $className)
        {
            $bobControllerCoreTestFile = new ControllerCoreTestBuilder($entityList, $config, $className);
        }
    };

    function makeRepositoryTest($entityList, $config)
    {
        foreach($entityList as $className)
        {
            $bobRepositoryCoreTestFile = new RepositoryCoreTestBuilder($entityList, $config, $className);
        }
    };

    function makeRepositoryCoreTest($entityList, $config)
    {
        foreach($entityList as $className)
        {
            $bobRepositoryTestFile = new RepositoryTestBuilder($entityList, $config, $className);
        }
    };

    function makeSupportFilesForTests($entityList, $config)
    {
        foreach($entityList as $className)
        {
            $bobSeedFile = new SeedBuilder($entityList, $config, $className);
        }

        foreach($entityList as $className)
        {
            $bobDBFile = new DbTestBuilder($entityList, $config, $className);
        }
    }


    function makeTestsBootstrapFile($entityList)
    {
        $bobTestsBootstrapFile = new TestsBootstrapBuilder($entityList);
    }
